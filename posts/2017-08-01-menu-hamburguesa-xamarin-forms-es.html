<!DOCTYPE html>
<html lang=""  itemscope itemtype="http://schema.org/Blog">
<head>
        <!–– Made with Lockdown: https://github.com/fferegrino/lockdown ––>
<meta charset="utf-8" />
<link rel="stylesheet" href="/css/main.css" />

        
</head>

<body>  
        <header class="site-header ui">
    <div class="wrapper menu">
      <nav class="site-nav">
        <a href="#" class="menu-icon">
          <svg viewBox="0 0 18 15">
            <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
            <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
            <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
          </svg>
        </a>
        <div class="trigger">
          <a class="link page-link" href="/">Home</a>
          <a class="link page-link" href="/about">About</a>
          <a class="link page-link" href="/search">Search</a>
        </div>
      </nav>
    </div>
    <div class="wrapper title">
      <div class="pure-g">
        <div class="pure-u-1-24 title-number"><span>1</span></div>
        <div class="pure-u-11-24 content-window">
          <a class="site-title" href="/">That C# guy</a>
        </div>
        <div class="pure-u-12-24 header-menu">
          <ul>
            <li class="datascience"><a href="/tag/data-science/">Data Science!</a></li>
            <li class="youtube"><a href="https://www.youtube.com/c/thatcsharpguy">YouTube<a></li>
            <li class="csharp"><a href="/tag/aprendecsharp/">Aprende C#</a></li>
            <li class="xamarin"><a href="/tag/xamarin/">Xamarin</a></li>
          </ul>
        </div>
      </div>
  
  </header>
        <div class="page-content">
            <div class="wrapper">
                
<h1></h1>

<p>Sí, en efecto, otro post sobre cómo crear un menú de hamburguesa en Xamarin.Forms, probablemente este sea como el millonésimo artículo al respecto. <em>Sin embargo, esta es mi forma, hay muchas otras, pero esta es la mía</em>.</p>
<p>Precaución, post largo a continuación. No olvides que puedes descargar <a href="https://github.com/ThatCSharpGuy/MenuApp/" target="_blank">aquí el código</a>, por si entre tanto te llegas a perder. Además, no dudes en hacerme llegar cualquier comentario.</p>
<h2 id="masterdetailpage"><code>MasterDetailPage</code></h2>
<p>En este post vamos a usar una <code>MasterDetailPage</code> para crear una app con un menú que se deslice del lado izquierdo de la pantalla, así que con eso vamos a comenzar con eso. Crea una página que herede de esta clase, yo le he puesto como nombre <code>MainPage</code>:</p>
<pre><code class="language-csharp">public class MainPage : MasterDetailPage
{
</code></pre>
<p>Luego, dentro del constructor de esta clase debes establecer las propiedades <code>Master</code> y <code>Detail</code>, para nosotros <code>Master</code> será la página en la que se muestre el menú y <code>Detail</code> en donde se muestre el contenido de la app. Por el momento solamente vamos establecerla dos páginas genéricas, sin nada de significado para la app:</p>
<pre><code class="language-csharp">public MainPage()
{
    Master = new ContentPage
    {
        Title= &quot;Master page&quot;,
        Content = new StackLayout
        {
            Children =
            {
                new Label{ Text = &quot;Master page&quot; }
            }
        }
    };

    Detail = new ContentPage
    {
        Title = &quot;Detail page&quot;,
        Content = new StackLayout
        {
            Children =
            {
                new Label{ Text = &quot;Detail page&quot; }
            }
        }
    };
}
</code></pre>
<p>Asegúrate de que esta página esté establecida como <code>MainPage</code> en la clase <code>App</code> de tu proyecto de Forms.</p>
<p>Ahora, para fines de este proyecto vamos a crear unas cuantas páginas que sí tendrán relación con la lógica de nuestra app, no voy a poner el código completo aquí, pero la app mostrará los gimnasios pokémon de la liga Índigo, los miembros de la Élite 4 y los distintos tipos de pokémon, así como detalles para cada una de ellas. Pero toma en cuenta, <em>las páginas principales son <code>GymsPage</code>, <code>EliteFourPage</code> y <code>PokemonTypesPage</code></em>.</p>
<h2 id="construccion-del-menu">Construcción del menú</h2>
<h3 id="menulistitem"><code>MenuListItem</code></h3>
<p>Nuestro menú será una simple lista cuyas filas harán la función de botones. Cada uno de estos &quot;botones&quot; estará representado por la clase <code>MenuListItem</code> cuya definición es la siguiente:</p>
<pre><code class="language-csharp">public class MenuListItem
{
    public string Title { get; set; }
    public string Icon { get; set; }
    public Type Page { get; set; }
}
</code></pre>
<p>Las dos primeras propiedades son sencillas de identificar (el título del menú y la imagen asociada a este), sin embargo, la tercera no lo es tanto: esta debe ser el tipo de página que se debe mostrar cuando el usuario seleccione esta opción, más adelante veremos su uso.</p>
<h3 id="menulistview"><code>MenuListView</code></h3>
<p>Ahora, mientras que podríamos usar un <code>ListView</code> directamente, vamos a usar un derivado, por si en algún momento necesitamos añadirle funcionalidad o crear un <a href="..\custom-renderer-paint-code-es" target="_blank"><i>custom renderer</i></a> de esta para mostrar los ítems que creamos anteriormente, entonces crea una clase llamada <code>MenuListView</code>:</p>
<pre><code class="language-csharp">public class MenuListView : ListView
{
</code></pre>
<p>Y en el constructor de esta clase crea los ítems que formarán parte del menú y establécelos como la propiedad <code>ItemsSource</code>. Acá es donde se verá el uso de la propiedad <code>Page</code>:</p>
<pre><code class="language-csharp">public MenuListView()
{
    var menus = new List&lt;MenuListItem&gt;
    {
        new MenuListItem
        {
            Title = &quot;Gimnasios&quot;,
            Icon = &quot;gym.png&quot;,
            Page = typeof(GymsPage)
        },
        new MenuListItem
        {
            Title = &quot;Elite 4&quot;,
            Icon = &quot;elite.png&quot;,
            Page = typeof(EliteFourPage)
        },
        new MenuListItem
        {
            Title = &quot;Tipos pokemon&quot;,
            Icon = &quot;types.png&quot;,
            Page = typeof(PokemonTypesPage)
        }
    };
    ItemsSource = menus;
}
</code></pre>
<h3 id="menuitemcell"><code>MenuItemCell</code></h3>
<p>Para mostrar los menús estaremos utilizando una <code>ImageCell</code>, pero, al igual que con la <code>MenuListView</code> usaremos una clase derivada por si en el futuro debemos añadirle funcionalidad:</p>
<pre><code class="language-csharp">public class MenuListItemCell : ImageCell
{
}
</code></pre>
<p>Ahora, en el constructor de nuestra lista, estableceremos el <em>template</em> de las celdas para que utilice este nuevo que acabamos de crear:</p>
<pre><code class="language-csharp">ItemsSource = menus;

var cellTemplate = new DataTemplate(typeof(MenuListItemCell));
cellTemplate.SetBinding(TextCell.TextProperty, nameof(MenuListItem.Title));
cellTemplate.SetBinding(ImageCell.ImageSourceProperty, nameof(MenuListItem.Icon));

ItemTemplate = cellTemplate;
</code></pre>
<h3 id="sidemenupage"><code>SideMenuPage</code></h3>
<p>Listo hasta ahora hemos creado ya casi toda la infraestructura necesaria para echar a andar nuestro menú: tenemos las opciones de menú, la lista en la que se mostrarán y la celda en la que lo harán, pero nos falta un lugar en donde ponerlos. Para esto, crea una clase llamad <code>SideMenuPage</code>, que será una página como cualquier otra:</p>
<pre><code class="language-csharp">public class SideMenuPage : ContentPage
{
</code></pre>
<p>Y dentro de su constructor debes crear la apariencia con la que debe contar tu menú, aquí es donde se crea y se muestra, ahora sí, la lista de menús:</p>
<pre><code class="language-csharp">public SideMenuPage()
{
    Title = &quot;Pokémon&quot;;
    var containerGrid = new Grid
    {
        RowDefinitions =
        {
            new RowDefinition {Height = new GridLength(1, GridUnitType.Auto)},
            new RowDefinition {Height = new GridLength(1, GridUnitType.Star)}
        }
    };
    var titleLabel = new Label()
    {
        FontSize = Device.GetNamedSize(NamedSize.Large, typeof(Label)),
        Text = Title, Margin = 10,
        HorizontalTextAlignment = TextAlignment.Center        
    };

    var menuList = new MenuListView();
    containerGrid.Children.Add(titleLabel);
    containerGrid.Children.Add(menuList, 0, 1);
    Content = containerGrid;
}
</code></pre>
<p>Y ahora la casi culminación de todos nuestros esfuerzos. Dentro de tu <code>MainPage</code> (la que deriva del <em>masterdetail</em>) establece la propiedad master a una instancia de <code>SideMenuPage</code>:</p>
<pre><code class="language-csharp">var sideMenuPage = new SideMenuPage();
Master = sideMenuPage;
</code></pre>
<p>Ahora, podrías ejecutar tu aplicación y verla en &quot;casi&quot; todo su esplendor.</p>
<h2 id="anadiendo-la-navegacion">Añadiendo la navegación</h2>
<p>Si ejecutaste tu app verás que básicamente no hace nada. Pero no te preocupes, que vamos a cambiar eso justo ahora.</p>
<h3 id="seleccion-del-menu">Selección del menú</h3>
<p>Ahora toca añadir la posibilidad de saber qué ítem del menú fue presionado, para que nuestro programa reaccione de acuerdo a la opción del menú seleccionada. Entonces, dentro de la clase <code>SideMenuPage</code> añade un evento:</p>
<pre><code class="language-csharp">public event EventHandler&lt;MenuListItem&gt; MenuItemSelected;
</code></pre>
<p>Y a la lista de ítems agrégale un manejador a su evento <code>ItemSelected</code>:</p>
<pre><code class="language-csharp">var menuList = new MenuListView();
menuList.ItemSelected += InternalMenuItemSelected;
</code></pre>
<p>Dentro del manejador deberás invocar el evento que justamente acabas de añadir llamado <code>MenuItemSelected</code>, pasándole como argumento el menú seleccionado:</p>
<pre><code class="language-csharp">private void InternalMenuItemSelected(object sender, SelectedItemChangedEventArgs e)
{
    var menuItem = e.SelectedItem as MenuListItem;
    if (menuItem != null)
    {
        MenuItemSelected?.Invoke(this, menuItem);
        ((MenuListView) sender).SelectedItem = null;;
    }
}
</code></pre>
<p>Ahora, vamos a hacer uso de estas herramientas que acabamos de añadir, dentro del constructor de la clase <code>MainPage</code> añade un manejador a nuestra <code>sideMenuPage</code>:</p>
<pre><code class="language-csharp">sideMenuPage.MenuItemSelected += SideMenuPage_MenuItemSelected;
</code></pre>
<p>Dentro de este manejador es donde se llevará a cabo la navegación, por el momento la dejaremos pendiente:</p>
<pre><code class="language-csharp">private void SideMenuPage_MenuItemSelected(object sender, Controls.MenuListItem e)
{
    // Navegación
}
</code></pre>
<h3 id="menunavigationpage"><code>MenuNavigationPage</code></h3>
<p>Para realizar la navegación usaremos los mecanismos que nos ofrece Forms por default, y eso incluye hacer uso de <code>NavigationPage</code>, pero nuevamente haremos uso de una clase derivada porque vamos a añadirle un par de eventos que nos ayudarán a saber si es que la página inicial (con la que se creó inicialmente la <code>NavigationPage</code>) se está mostrando.</p>
<pre><code class="language-csharp">public class MenuNavigationPage : NavigationPage
{
    public MenuNavigationPage(Page root) : base(root)
    {
</code></pre>
<p>En este caso el argumento <code>root</code> será nuestra página inicial, así que la almacenaremos en un campo llamado <code>_landingPage</code>, además le agregaremos un par de manejadores de eventos para saber cuándo esta página aparezca y desaparezca ante los ojos del usuario:</p>
<pre><code class="language-csharp">        _landingPage = root;
        _landingPage.Appearing += PageAppearing;
        _landingPage.Disappearing += PageDisappearing;
    }

    private readonly Page _landingPage;
</code></pre>
<p>Hasta este punto tenemos manejado el evento dentro de nuestra página, pero ahora debemos hacer disponible un par de eventos que se llamarán cuando aparezca y desaparezca la página inicial:</p>
<pre><code class="language-csharp">
    public event EventHandler InitialPageAppearing;
    public event EventHandler InitialPageDisappearing;

    private void PageDisappearing(object sender, EventArgs e)
    {
        InitialPageDisappearing?.Invoke(sender, e);
    }

    private void PageAppearing(object sender, EventArgs e)
    {
        InitialPageAppearing?.Invoke(sender, e);
    }
}
</code></pre>
<p>Listo, una vez que tenemos ya una página para hacer la navegación, podemos llevarla a cabo dentro del manejador que dejamos pendiente de implementar. Usamos la clase <code>Activator</code> para crear una instancia de la página que vamos a mostrar, la &quot;envolvemos&quot; en una <code>MenuNavigationPage</code> y la establecemos como <code>Detail</code> de nuestra <code>MainPage</code>. Por mediante <code>IsPresented</code> le indicamos al menú que se esconda una vez que se ha presentado ya una página nueva:</p>
<pre><code class="language-csharp">private void SideMenuPage_MenuItemSelected(object sender, Controls.MenuListItem e)
{
    MenuNavigationPage page;
    var actualContentPage = (Page)Activator.CreateInstance(e.Page);
    page = new MenuNavigationPage(actualContentPage);
    Detail = page;
    IsPresented = false;
}
</code></pre>
<p>Y listo, hasta aquí ya debería funcionar todo correctamente, la navegación de tu app funciona y es una maravilla. Sin embargo, quédate para un par de mejoras:</p>
<h3 id="deshabilitando-el-deslizamiento-del-menu">Deshabilitando el deslizamiento del menú</h3>
<p>Algo que me desagradaba bastante es que cuando el usuario está en una página que no es una de las <em>páginas iniciales</em>  podía abrir el menú y navegar a otra pantalla. Para hacer que el menú aparezca bastaba con deslizar el dedo desde el borde izquierdo de la pantalla. Para nuestra fortuna, podemos deshabilitar característica mediante la propiedad <code>IsGestureEnabled</code> de nuestra <code>MainPage</code>, pero para esto, a cada una de las páginas que vayamos creando debemos agregarle un par de manejadores para sus eventos de aparición/desaparición de la página inicial:</p>
<pre><code class="language-csharp">    // ...
    page = new MenuNavigationPage(actualContentPage);
    page.InitialPageAppearing += Page_InitialPageAppearing;
    page.InitialPageDisappearing += Page_InitialPageDisappearing;
    Detail = page;
    // ...
</code></pre>
<p>Y dentro de dichos manejadores habilitaremos y deshabilitaremos el gesto del menú:</p>
<pre><code class="language-csharp">private void Page_InitialPageDisappearing(object sender, EventArgs e)
{
    IsGestureEnabled = false;
}

private void Page_InitialPageAppearing(object sender, EventArgs e)
{
    IsGestureEnabled = true;
}
</code></pre>
<h3 id="reusando-las-paginas-experimental">Reusando las páginas (experimental)</h3>
<p>Hasta ahora cada vez que el usuario selecciona una opción del menú se crea una nueva página, entonces es crear y crear recursos nuevos, es por eso que podemos evitar esto creando una especie de almacenamiento para nuestras páginas, y si el usuario selecciona una que ya había abierto con anterioridad podemos presentarle esa, en lugar de crear una nueva. Esto se logra mediante la introducción de un diccionario cuya llave sea el tipo de página y valor sea una instancia de dicho tipo:</p>
<pre><code class="language-csharp">private Dictionary&lt;Type, MenuNavigationPage&gt; _pages = new Dictionary&lt;Type, MenuNavigationPage&gt;();
</code></pre>
<p>Y ahora si podemos almacenar las páginas en este diccionario y sacarlas de ahí o crearlas y almacenarlas para el futuro:</p>
<pre><code class="language-csharp">private void SideMenuPage_MenuItemSelected(object sender, Controls.MenuListItem e)
{
    MenuNavigationPage page;
    if (!_pages.TryGetValue(e.Page, out page))
    {
        var actualContentPage = (Page)Activator.CreateInstance(e.Page);
        page = new MenuNavigationPage(actualContentPage);
        page.InitialPageAppearing += Page_InitialPageAppearing;
        page.InitialPageDisappearing += Page_InitialPageDisappearing;
        _pages.Add(e.Page, page);
    }
    Detail = page;
    IsPresented = false;
}
</code></pre>
<p>(En realidad me hace falta perfilar esta solución y ver si no existe una fuga de memoria por ahí).</p>
<p>Y pues listo, eso es todo. Sé que podrían quedar un montón de dudas y después de tantas clases derivadas y eventos y <em>bla, bla, bla</em>, sin embargo, te invito a que descargues <a href="https://github.com/ThatCSharpGuy/MenuApp/" target="_blank">aquí el código</a> y lo sigas paso a paso, demás, no dudes en ponerte en contacto conmigo.</p>


            </div>
          </div>
        
</body>
</html>
