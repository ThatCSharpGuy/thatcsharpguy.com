<!DOCTYPE html>
<html lang="es"  itemscope itemtype="http://schema.org/Blog">
<head>
        <!â€“â€“ Made with Lockdown: https://github.com/fferegrino/lockdown â€“â€“>
<meta charset="utf-8" />
<link rel="stylesheet" href="/css/main.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/vs.min.css" integrity="sha512-aWjgJTbdG4imzxTxistV5TVNffcYGtIQQm2NBNahV6LmX14Xq9WwZTL1wPjaSglUuVzYgwrq+0EuI4+vKvQHHw==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script data-ad-client="ca-pub-9566151416325480" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">


<title>Creating a dotnet tool (part 3) | That C# guy</title>
<!-- Search Engine -->
<meta name="description" content="This time I'll show you how to perform Continuous Deployment to NuGet from GitHub Actions.">
<meta name="image" content="https://i.imgur.com/C0Nqt9A.png">
<!-- Schema.org for Google -->
<meta itemprop="name" content="Creating a dotnet tool (part 3)">
<meta itemprop="description" content="This time I'll show you how to perform Continuous Deployment to NuGet from GitHub Actions.">
<meta itemprop="image" content="https://i.imgur.com/C0Nqt9A.png">
<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Creating a dotnet tool (part 3)">
<meta name="twitter:description" content="This time I'll show you how to perform Continuous Deployment to NuGet from GitHub Actions.">
<meta name="twitter:site" content="@io_exception">
<meta name="twitter:creator" content="@io_exception">
<meta name="twitter:image" content="https://i.imgur.com/C0Nqt9A.png">
<!-- Open Graph general (Facebook, Pinterest & Google+) -->
<meta name="og:title" content="Creating a dotnet tool (part 3)">
<meta name="og:description" content="This time I'll show you how to perform Continuous Deployment to NuGet from GitHub Actions.">
<meta name="og:image" content="https://i.imgur.com/C0Nqt9A.png">
<meta name="og:url" content="https://thatcsharpguy.com/posts/2021-01-23-creating-dotnet-tool-scratch-part-3.html">
<meta name="og:site_name" content="That C# guy">
<meta name="og:locale" content="es">
<meta name="og:type" content="website">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPXCSH21CP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GPXCSH21CP');
</script>

        
</head>

<body>  
        <header class="site-header ui">
    <div class="wrapper menu">
      <nav class="site-nav">
        <a href="#" class="menu-icon">
          <svg viewBox="0 0 18 15">
            <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
            <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
            <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
          </svg>
        </a>
        <div class="trigger">
          <a class="link page-link" href="/">Inicio</a>
          <!-- <a class="link page-link" href="/">Sobre mi</a> -->
          <a class="link page-link youtube" href="/">YouTube</a>
          <a class="link page-link book-reviews" href="/tags/book-review.html">ReseÃ±as</a>
          <!-- <a class="link page-link gear" href="/">Herramientas</a> -->
          <!-- <a class="link page-link" href="/about">About</a> -->
          <!-- <a class="link page-link" href="/search">Search</a> -->
        </div>
      </nav>
    </div>
    <div class="wrapper title">
      <div class="pure-g">
        <div class="pure-u-1-24 title-number"><span>1</span></div>
        <div class="pure-u-11-24 content-window">
          <a class="site-title" href="/">That C# guy</a>
        </div>
      </div>
  
  </header>
        <div class="page-content">
            <div class="wrapper">
                
<h1>Creating a dotnet tool (part 3)</h1>

<blockquote>
<p>This is a rough draft: explanations are incomplete and there may be spelling mistakes. I just made it public for people that have a hard time copying commands from a video.</p>
</blockquote>
<p>If you speak spanish and prefer to see me coding this, you can do so in this video: <a href="https://youtu.be/h8pM1EyOmXQ">IngenierÃ­a de software - Continuous Delivery</a>.</p>
<p>Lockdown is a static website generator written in C# that works as a <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/global-tools">.NET tool</a>.</p>
<p>Through this series of posts I'll guide you on how did I build this tool with the hopes that you will be able to create another <em>dotnet</em> tool (hopefully you won't build a better Lockdown competitor, though ðŸ˜…).</p>
<h2 id="topics">Topics</h2>
<ul>
<li>Adding versioning to our app</li>
<li>Releasing from CI</li>
<li>Working with the FileSystem</li>
<li>Tests against the file system</li>
</ul>
<h2 id="adding-versioning-to-our-app">Adding versioning to our app</h2>
<p>Let's install <a href="https://github.com/lockdownblog/bumpversion">versionbump</a>, which is, funnlily enough another <code>dotnet tool</code>:</p>
<blockquote>
<p>First of all, full disclaimer, <code>versionbump</code> is a tool developed by me and while it works, it may not be perfectly suited to your needs. You may consider using some other tools. Once you are advised.</p>
</blockquote>
<pre><code class="language-bash">dotnet tool install --global BumpVersion
</code></pre>
<p>Once you have done this, it may be wise to check the installation was smooth:</p>
<pre><code class="language-bash">bumpversion --version
</code></pre>
<h3 id="add-configuration-file">Add configuration file</h3>
<p>Let's add a <code>.bumpversion.cfg</code> file to the root of our project:</p>
<pre><code class="language-text">[bumpversion]
current_version = &quot;0.0.0&quot;
commit = true
tag = true
</code></pre>
<p>Since we put our version number in code, we should also add the following section to our file:</p>
<pre><code class="language-text">[bumpversion.file.0]
file = &quot;Lockdown/Program.cs&quot;
search = &quot;{current_version}&quot;
replace = &quot;{new_version}&quot;
</code></pre>
<p>Next up, is testing our tool is working by simply bumping the <em>patch</em> part with the following command:</p>
<pre><code class="language-bash">bumpversion patch
</code></pre>
<p>Check your GitHub history, you'll see that there are new tags. These tags are living locally in our machine, but we need them on the server too, to push them it is necessary to do a</p>
<pre><code class="language-bash">git push --follow-tags
</code></pre>
<p>If you check GitHub, you'll see that now we have pushed our tags there also; from these tags you can create a new fancy release in your project's page telling the world about your new fancypants application.</p>
<h2 id="integrating-tags-with-our-ci">Integrating tags with our CI</h2>
<p>Next up, we need to make sure our CI pipeline treats our new tag in a special manner, to do this, let's create another CI workflow, this time, we'll call it <code>tags.yml</code>, and, for now, it will be almost a complete copy of our previous pipeline, the only bit that we'll change are the conditions under which this pipeline should be executed:</p>
<pre><code class="language-yaml">name: Tags pipeline

on:
  push:
    tags:
      - 'v*'
</code></pre>
<p>This is telling the pipeline that it should run only when new tags are pushed to the repository, in this case, you can see, our tags should start with the &quot;v&quot; character.</p>
<h2 id="preparing-our-nuget-package">Preparing our NuGet package</h2>
<p>We are almost ready to publish a beta version of our package, and reserve our name in NuGet!, but first let's change our code to tell our users that this is not production ready:</p>
<pre><code class="language-csharp">this.console.WriteLine(&quot;You executed the build command. This is a placeholder package for my new tool, coming soon&quot;);
</code></pre>
<p>Obviously, we also need to modify the tests:</p>
<pre><code class="language-csharp">writtenText.ShouldBe(&quot;You executed the build command. This is a placeholder package for my new tool, coming soon.&quot; + Environment.NewLine);
</code></pre>
<h3 id="nuget">NuGet!</h3>
<p>Once we've done this, head over to nuget.org and log in with a Microsoft Account, check that the name you'll use for your package is not taken.</p>
<p>We need to add some metadata to our package in order for it to look nice and be indexable in the package directory. The file we need to modify is <code>Lockdown/Lockdown.csproj</code>.</p>
<p>To begin, we need to tell NuGet that our code is a <em>dotnet tool</em>:</p>
<pre><code class="language-xml">&lt;PackAsTool&gt;true&lt;/PackAsTool&gt;
&lt;ToolCommandName&gt;lockdown-test&lt;/ToolCommandName&gt;
&lt;PackageOutputPath&gt;./nupkg&lt;/PackageOutputPath&gt;
</code></pre>
<p>Then, let's set up some unique id versioning for our app:</p>
<pre><code class="language-xml">&lt;PackageId&gt;Lockdown.Tutorial&lt;/PackageId&gt;
&lt;AssemblyVersion&gt;0.0.1&lt;/AssemblyVersion&gt;
&lt;Version&gt;0.0.1&lt;/Version&gt;
</code></pre>
<p>Lastly, let's add even more metadata:</p>
<pre><code class="language-xml">&lt;Authors&gt;fferegrino&lt;/Authors&gt;
&lt;Title&gt;lockdown test&lt;/Title&gt;
&lt;PackageDescription&gt;A static website generator&lt;/PackageDescription&gt;
&lt;Description&gt;A static website generator&lt;/Description&gt;
&lt;PackageLicenseExpression&gt;MIT&lt;/PackageLicenseExpression&gt;
&lt;PackageProjectUrl&gt;https://github.com/lockdownblog/lockdown-en-vivo/&lt;/PackageProjectUrl&gt;
&lt;RepositoryUrl&gt;https://github.com/lockdownblog/lockdown-en-vivo/&lt;/RepositoryUrl&gt;
&lt;PackageIcon&gt;icon.png&lt;/PackageIcon&gt;
&lt;PackageTags&gt;static;static-website;website;website-generator;html;jekyll;hugo&lt;/PackageTags&gt;
</code></pre>
<p>As part of this metadata, you can see that we have added a package icon, and while this is not necessary it just makes our tool's page look nicer. To add this icon, make sure you have an image ready to use. Once you have the image in place, we must add a reference to it in our <code>.csproj</code> project:</p>
<pre><code class="language-xml">&lt;ItemGroup&gt;
    &lt;None Include=&quot;icon.png&quot; Pack=&quot;true&quot; PackagePath=&quot;&quot; /&gt;
&lt;/ItemGroup&gt;
</code></pre>
<p>And with that, the metadata for our project is done.</p>
<p>Executing <code>dotnet pack -c Release</code> will create a <code>.nupkg</code> in the folder we specified earlier within the metadata.</p>
<h3 id="publishing-to-nuget">Publishing to NuGet</h3>
<p>For the next step, let's open two tabs in our browser, one in the settings of our repository, specifically in the secrets section. In here we'll need to add a new secret, in the name we'll set <code>NUGET_KEY</code> and as for the value... we'll leave it empty for now and move on to our next tab.</p>
<p>It is time we go back to NuGet, and within your account, navigate to API Keys <a href="https://www.nuget.org/account/apikeys">https://www.nuget.org/account/apikeys</a>, create a new one, ideally you'll set more restrictive permissions here, but whatever, we are good for now.</p>
<p>Copy the value of the secret key, go back to the tab with the GitHub secret open, paste it there and save it!</p>
<p>The next step is adding a couple of steps in our <code>tags.yml</code> pipeline:</p>
<pre><code class="language-yml">- name: Build
  run: dotnet pack -c Release

- name: Publish to NuGet
  run: dotnet nuget push -k $ -s https://www.nuget.org Lockdown/nupkg/
</code></pre>
<p>Once we have done this, we can go ahead a add new tags to our repo, wait for it to be deployed and then enjoy the fireworks!</p>
<pre><code class="language-bash">bumpversion patch
git push --follow-tags
</code></pre>


            </div>
        </div>
        <footer class="site-footer ui">
   <div class="wrapper pure-g">
      <div class="pure-u-1 pure-u-md-8-24">
         <div class="footer-content">
            <ul class="icon-list">
        <li id="em">
            <a href="mailto:feregrino@thatcsharpguy.com" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M31 11.815v13.292q0 1.105-.787 1.892-.787.78-1.892.78H3.68q-1.106 0-1.893-.79Q1 26.21 1 25.102v-13.29q.737.82 1.69 1.46 6.06 4.12 8.32 5.78.955.705 1.55 1.1.594.392 1.582.802.987.41 1.84.41h.035q.854 0 1.84-.41.99-.41 1.583-.804.595-.393 1.55-1.096 2.845-2.06 8.336-5.778.954-.652 1.674-1.455zm0-4.922q0 1.322-.82 2.528t-2.043 2.06l-7.835 5.44-.71.51q-.545.4-.905.64t-.87.55q-.51.3-.963.45-.452.15-.837.15h-.034q-.385 0-.837-.15-.452-.15-.962-.45-.51-.302-.87-.544-.36-.243-.905-.637l-.72-.51q-1.525-1.07-4.388-3.055-2.86-1.984-3.43-2.386-1.04-.704-1.96-1.935Q1 8.315 1 7.26q0-1.305.695-2.175.695-.87 1.984-.87h24.64q1.09 0 1.88.786.792.79.792 1.9z"/></svg>
            </a>
        </li>
        <li id="gh">
            <a href="https://github.com/ThatCSharpGuy" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M31 16.37q0 4.9-2.86 8.8-2.86 3.93-7.4 5.43-.52.1-.77-.13-.24-.24-.24-.6v-4.1q0-1.9-1.02-2.78 1.2-.2 2.1-.4.9-.3 1.87-.8.95-.5 1.58-1.3.65-.8 1.05-2.1.4-1.27.4-2.93 0-2.38-1.54-4.04.7-1.78-.16-3.98-.57-.2-1.6.2t-1.8.85l-.75.47q-1.83-.5-3.76-.5t-3.76.5l-.8-.54Q11 8.16 9.9 7.7q-1.13-.4-1.7-.23-.86 2.2-.14 3.97-1.54 1.68-1.54 4.05 0 1.6.4 2.9.4 1.23 1.02 2.02.63.8 1.58 1.3.94.53 1.83.77.9.25 2 .37-.77.7-.94 2-.4.2-.82.3-.47.1-1.1.1-.66 0-1.3-.44-.63-.4-1.08-1.2-.38-.63-.95-1-.52-.4-.9-.5l-.4-.03q-.4 0-.57.1-.15.1-.1.24.06.13.18.26t.26.2l.15.1q.44.2.86.73t.63 1l.2.43q.23.75.84 1.2.6.47 1.3.6.7.13 1.34.14.65 0 1.08-.04l.46-.08v2.74q0 .35-.26.6-.25.22-.8.12-4.5-1.5-7.37-5.42-3-3.74-3-8.64 0-4.1 2-7.54 2-3.44 5.45-5.46 3.45-2 7.53-2t7.6 2q3.4 2 5.4 5.46 2 3.44 2 7.53z"/></svg>
            </a>
        </li>
        <li id="yt">
            <a href="https://www.youtube.com/c/thatcsharpguy" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M22.43 15.714c0-.413-.17-.714-.504-.904l-8.57-5.357c-.347-.223-.71-.234-1.09-.033-.368.2-.552.513-.552.937V21.07c0 .426.184.738.553.94.178.088.35.133.52.133.222 0 .412-.056.568-.168l8.57-5.357c.336-.19.504-.49.504-.904zm8.57 0c0 1.072-.006 1.91-.017 2.51-.01.604-.058 1.366-.142 2.287-.083.92-.208 1.744-.376 2.47-.178.815-.563 1.5-1.155 2.06-.592.557-1.284.88-2.077.97-2.477.28-6.222.42-11.233.42-5.01 0-8.756-.14-11.233-.42-.793-.09-1.487-.413-2.085-.97-.597-.56-.984-1.245-1.163-2.06-.157-.726-.277-1.55-.36-2.47-.085-.92-.132-1.682-.143-2.285-.01-.602-.017-1.44-.017-2.51 0-1.072.006-1.91.017-2.512.01-.603.058-1.364.142-2.285.083-.92.208-1.744.376-2.47.178-.814.563-1.5 1.155-2.058.592-.56 1.284-.882 2.077-.97C7.244 5.14 10.99 5 16 5c5.01 0 8.756.14 11.233.42.793.088 1.487.41 2.085.97.597.558.984 1.244 1.163 2.06.157.724.277 1.547.36 2.468.085.92.132 1.682.143 2.285.01.603.017 1.44.017 2.51z"/></svg>
            </a>
        </li>
        <li id="tw">
            <a href="https://twitter.com/io_exception" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M31 6.7q-1.28 1.88-3.08 3.2.02.26.02.8 0 2.46-.73 4.93-.7 2.46-2.2 4.73-1.46 2.26-3.5 4-2.04 1.75-4.9 2.8-2.88 1.02-6.16 1.02-5.16 0-9.44-2.76.67.08 1.48.08 4.3 0 7.64-2.63-2-.04-3.58-1.23-1.58-1.2-2.17-3.03.63.1 1.16.1.82 0 1.62-.2-2.13-.44-3.53-2.13-1.4-1.68-1.4-3.9v-.1q1.3.74 2.78.8-1.26-.84-2-2.2-.74-1.35-.74-2.93 0-1.67.83-3.1 2.3 2.84 5.6 4.54 3.3 1.7 7.07 1.9-.15-.73-.15-1.4 0-2.57 1.8-4.36 1.8-1.8 4.35-1.8 2.66 0 4.5 1.94 2.07-.4 3.9-1.5-.7 2.2-2.7 3.4 1.76-.2 3.53-.95z"/></svg>
            </a>
        </li>    
        <li id="fb">
            <a href="https://www.facebook.com/thatcsharpguy" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.512 1.488c.325.326.488.716.488 1.172v26.68c0 .456-.163.846-.488 1.172-.326.325-.716.488-1.172.488h-7.637V19.38h3.887l.586-4.532h-4.473v-2.89c0-.73.153-1.277.46-1.642.305-.364.9-.546 1.786-.546l2.382-.02V5.707c-.82-.117-1.98-.176-3.477-.176-1.77 0-3.186.522-4.248 1.564-1.06 1.04-1.59 2.513-1.59 4.414v3.34h-3.908v4.53h3.906V31H2.66c-.456 0-.846-.163-1.172-.488C1.163 30.186 1 29.796 1 29.34V2.66c0-.456.163-.846.488-1.172C1.814 1.163 2.204 1 2.66 1h26.68c.456 0 .846.163 1.172.488z"/></svg>
            </a>
        </li>
        <li id="gp">
            <a href="https://www.google.com/+Thatcsharpguy" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.9 14.25h-2.7v-2.72h-2.73v2.72h-2.7v2.72h2.7v2.7h2.72v-2.7h2.7v-2.72M10.5 17.5h5.4c-.22 1.4-1.64 4.12-5.4 4.12-3.25 0-5.9-2.7-5.9-6 0-3.33 2.65-6.02 5.9-6.02 1.85 0 3.08.78 3.8 1.46l2.58-2.48c-1.66-1.55-3.8-2.5-6.38-2.5C5.26 6.1 1 10.35 1 15.62s4.26 9.52 9.52 9.52c5.5 0 9.14-3.86 9.14-9.3 0-.62-.07-1.1-.15-1.57h-8.96"/></svg>
            </a>
        </li>
    </ul>
    <ul class="icon-list">
        <li>
            <a href="#">
                <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M7 18.89v-5.88H1.15v-6H7V1.1h6v5.91h6V1.1h6v5.91h5.85v6H25v5.88h5.85v6H25v5.912h-6v-5.91h-6v5.91H7v-5.91H1.15v-6H7zm6 0v-5.88h6v5.88h-6z" fill="#3C8A3F" fill-rule="evenodd"/></svg>
            </a>
        </li>
    </ul>
         </div>
      </div>
      <div class="pure-u-1 pure-u-md-6-24">
      </div>
      <div class="pure-u-1 pure-u-md-10-24">
         <div class="footer-content">
         </div>
      </div>
   </div>
</footer>
</body>
</html>
