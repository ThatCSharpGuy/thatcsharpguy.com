<!DOCTYPE html>
<html lang="es" itemscope itemtype="http://schema.org/Blog">
    <head>
        <!–– Made with Lockdown: https://github.com/fferegrino/lockdown ––>
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"></meta>

  <link rel="shortcut icon" href="">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  <script src="https://kit.fontawesome.com/0271495296.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/main.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/vs.min.css" integrity="sha512-aWjgJTbdG4imzxTxistV5TVNffcYGtIQQm2NBNahV6LmX14Xq9WwZTL1wPjaSglUuVzYgwrq+0EuI4+vKvQHHw==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script data-ad-client="ca-pub-9566151416325480" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2176ff">
<meta name="msapplication-TileColor" content="#eeeef2">
<meta name="theme-color" content="#eeeef2">


  <title>Trabajando con XslX en C# | That C# guy</title>

  <!-- Search Engine -->
  <meta name="description" content="¿Quieres trabajar con documentos de Word sin tener que depender de Office? DocX es la librería para ti. Con ella tienes un montón de opciones disponibles para desarrollar. Conócela aquí.">
  <meta name="image" content="">
  <!-- Schema.org for Google -->
  <meta itemprop="name" content="Trabajando con XslX en C#">
  <meta itemprop="description" content="¿Quieres trabajar con documentos de Word sin tener que depender de Office? DocX es la librería para ti. Con ella tienes un montón de opciones disponibles para desarrollar. Conócela aquí.">
  <meta itemprop="image" content="">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Trabajando con XslX en C#">
  <meta name="twitter:description" content="¿Quieres trabajar con documentos de Word sin tener que depender de Office? DocX es la librería para ti. Con ella tienes un montón de opciones disponibles para desarrollar. Conócela aquí.">
  <meta name="twitter:site" content="@io_exception">
  <meta name="twitter:creator" content="@io_exception">
  <meta name="twitter:image" content="">
  <!-- Open Graph general (Facebook, Pinterest & Google+) -->
  <meta name="og:title" content="Trabajando con XslX en C#">
  <meta name="og:description" content="¿Quieres trabajar con documentos de Word sin tener que depender de Office? DocX es la librería para ti. Con ella tienes un montón de opciones disponibles para desarrollar. Conócela aquí.">
  <meta name="og:image" content="">
  <meta name="og:url" content="https://thatcsharpguy.com/">
  <meta name="og:site_name" content="That C# guy">
  <meta name="og:locale" content="es">
  <meta name="og:type" content="website">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPXCSH21CP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GPXCSH21CP');
</script>

        
    </head>
    <body style="position: relative; min-height: 100%; top: 0px;">
        <header class="site-header " role="banner">
  <div class="wrapper">
     <div class="site-header-inner">
       <span class="site-brand">
         <a class="site-brand-inner" rel="author" href="/">
          <!-- <img class="site-favicon" title="Your awesome title" src="" onerror="this.style.display='none'"> -->
          That C# guy
        </a>
      </span>
        <nav class="site-nav">
           <input type="checkbox" id="nav-trigger" class="nav-trigger">
           <label for="nav-trigger">
              <span class="menu-icon">
                 <svg viewbox="0 0 18 15" width="18px" height="15px">
                    <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
                 </svg>
              </span>
           </label>
           <div class="trigger">
             <!-- Header links -->
              <a class="page-link" target="_blank" href="https://www.youtube.com/thatcsharpguy/">YOUTUBE</a>
              <span class="page-link">
    <div id="google_translate_element" style="display: none;"></div>
    <span class="ct-language">
       <ul class="list-unstyled ct-language-dropdown">
         <li>
            <a href="#" class="lang-select" data-lang="es">
            <img src="https://www.countryflags.io/mx/flat/64.png" title="México">
            </a>
         </li>
          <li>
             <a href="#" class="lang-select" data-lang="en">
             <img src="https://www.countryflags.io/gb/flat/64.png" title="English">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="fr">
             <img src="https://www.countryflags.io/fr/flat/64.png" title="Franch">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="zh-CN">
             <img src="https://www.countryflags.io/cn/flat/64.png" title="Chinese(Simple)">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ja">
             <img src="https://www.countryflags.io/jp/flat/64.png" title="Japan">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ko">
             <img src="https://www.countryflags.io/kr/flat/64.png" title="Korean">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ru">
             <img src="https://www.countryflags.io/ru/flat/64.png" title="Russia">
             </a>
          </li>
       </ul>
    </span>
    <script type="text/javascript">
       function googleTranslateElementInit() {
         new google.translate.TranslateElement({
           pageLanguage: '',
           autoDisplay: false,
           layout: google.translate.TranslateElement.InlineLayout.VERTICAL
         }, 'google_translate_element');
       
         function restoreLang() {
           var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
           if (!iframe) return;
       
           var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
           var restore_el = innerDoc.getElementsByTagName("button");
       
           for (var i = 0; i < restore_el.length; i++) {
             if (restore_el[i].id.indexOf("restore") >= 0) {
               restore_el[i].click();
               var close_el = innerDoc.getElementsByClassName("goog-close-link");
               close_el[0].click();
               return;
             }
           }
         }
       
         function triggerHtmlEvent(element, eventName) {
           var event;
           if (document.createEvent) {
             event = document.createEvent('HTMLEvents');
             event.initEvent(eventName, true, true);
             element.dispatchEvent(event);
           } else {
             event = document.createEventObject();
             event.eventType = eventName;
             element.fireEvent('on' + event.eventType, event);
           }
         }
       
         var googleCombo = document.querySelector("select.goog-te-combo");
         var langSelect = document.querySelector('.ct-language');
         langSelect.addEventListener('click', function(event) {
           if (!event.target) {
             return;
           }
       
           var selected = document.querySelector('.ct-language .ct-language-selected');
           if (selected) {
             selected.classList.remove('ct-language-selected');
           }
       
           var target = event.target;
           while (target && target !== langSelect ) {
             if (target.matches('.lang-select')) {
               break;
             }
             target = target.parentElement;
           }
       
           if (target && target.matches('.lang-select')) {
             var lang = target.getAttribute('data-lang');
             if (lang == "es") {
               restoreLang();
             } else {
               target.parentElement.classList.add('ct-language-selected');
               googleCombo.value = lang;
               triggerHtmlEvent(googleCombo, 'change');
             }
           }
       
           event.preventDefault();
         });
       }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
 </span>
           </div>
        </nav>
     </div>
  </div>
</header>
<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;

      documentElement.setAttribute("data-header-transparent", "");

      var scrollStatus = "";
      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }
      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }
    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });
    storeScrollData();
  })();
</script>
        
        <div class="theme-toggle">
  <input type="checkbox" id="theme-switch"/>
  <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
          <p class="light">Light</p>
          <p class="dark">Dark</p>
      </div>
  </label>
</div>
  


<script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>
        <div class="page-content">
            <div class="wrapper">
                <div class="framework">
                    <section class="main"> 
                        
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="post-content e-content" itemprop="articleBody">
        
<p>Justamente hace unos cuantos posts, les hablaba de cómo <a href="http://thatcsharpguy.com/post/docx-c-sharp/">trabajar con documentos de Word en C#</a>, y esta vez hablo sobre algo similar... solo que con hojas de cálculo de Excel, seguramente es una tarea más requerida dada la naturaleza, ligada a los datos, de este tipo de archivos. Esto es posible a través de una librería que también se distribuye a través de NuGet, la librería en cuestión se llama EPPlus y en este post presento algunos casos de uso.</p>
<p>En esta ocasión mostraré cómo crear un pequeño reporte de las clases y maestros que se imparten en una escuela, usando la misma información del <a href="http://thatcsharpguy.com/post/linq-en-c-sharp-3/">post sobre LINQ en C#</a>, para finalizar con un ejemplo de lectura de un libro de Excel en nuestra aplicación:</p>
<h2 id="creando-un-libro">Creando un libro</h2>
<p>Para crear un libro de excel usaremos la clase <code>ExcelPackage</code> junto con un objeto de la clase <code>FileInfo</code>, la documentación no indica que debemos emplear nuestro código dentro de un bloque <code>using</code>, pero para evitar sorpresas, creamos el documento dentro de uno:</p>
<pre><code class="language-csharp">FileInfo prueba = new FileInfo(&quot;prueba.xlsx&quot;);
using (ExcelPackage excel = new ExcelPackage(prueba))
{
    var workbook = excel.Workbook;
    // ... 
</code></pre>
<p>Podemos ver a la clase <code>ExcelPackage</code> como un contenedor de nuestro libro, al que podemos acceder a través de la propiedad <code>Workbook</code>.</p>
<h2 id="guardando-un-documento">Guardando un documento</h2>
<p>Al igual que con DocX, una vez creado el documento y después de que hemos terminado de trabajar con él debemos guardar nuestros cambios, esto se hace mediante una llamada a su método <code>Save</code>, con lo cual todos los cambios hechos en el documento serán aplicados sobre el archivo.</p>
<pre><code class="language-csharp">    // ...
    excel.Save();
}
</code></pre>
<p>Cabe señalar que también tenemos a nuestra disposición el método <code>SaveAs</code> que permite guardar una copia del documento con el que estamos trabajando, hay otra sobrecarga que inclusive nos eprmite establecer una contraseña para el archivo.</p>
<p>Si ejecutamos el código hasta este momento veremos un archivo <code>.xlsx</code> llamado &quot;prueba.xlsx&quot; en la carpeta donde está nuestra aplicación, en mi caso es dentro de <code>bin\Debug</code>, y es porque al crear nuestro documento únicamente empleamos el nombre de un archivo, pero bien pudimos usar una ruta absoluta para guardarlo en otro lugar.</p>
<p>&lt;img src=&quot;https://thatcsharpguy.github.io/postimages/xlsx-c-sharp/new-xlsx.png&quot; title=<>Documento vacío</> /&gt;</p>
<h2 id="agregando-informacion">Agregando información</h2>
<p>Queremos generar un reporte con todos los maestros en una hoja de Excel y así es una de las maneras en que se puede hacer usando EPPlus</p>
<h3 id="hojas-de-trabajo">Hojas de trabajo</h3>
<p>Para insertar datos en nuestro libro de Excel necesitamos primero agregar una hoja de trabajo o <em>worksheet</em>, lo cual se hace mediante el método <code>Add</code>, que recibe el nombre de la hoja que vamos a crear. Ten cuidado con intentar agregar dos hojas con el mismo nombre, puesto que esto no está permitido.</p>
<p>El método <code>Add</code> regresa una referencia a la hoja recién añadida y es precisamente usando esa referencia como vamos a añadir la información.</p>
<pre><code class="language-csharp">var teacherWorksheet = wb.Worksheets.Add(&quot;Maestros&quot;);
</code></pre>
<h3 id="celdas">Celdas</h3>
<p>Partiendo de la referencia a <code>teacherWorksheet</code> podemos ahora si trabajar con las celdas (<code>Cells</code>) de esa hoja, la forma de hacerlo es como lo haríamos manualmente en el documento, es decir, mediante el sistema de coordenadas compuesto por letras y números. Por ejemplo, si queremos añadir los nombres de las columnas para nuestros datos:</p>
<pre><code class="language-csharp">teacherWorksheet.Cells[&quot;A1&quot;].Value = &quot;ID&quot;;
teacherWorksheet.Cells[&quot;B1&quot;].Value = &quot;Nombre&quot;;
teacherWorksheet.Cells[&quot;C1&quot;].Value = &quot;Apellidos&quot;;
teacherWorksheet.Cells[&quot;D1&quot;].Value = &quot;Email&quot;;
teacherWorksheet.Cells[&quot;E1&quot;].Value = &quot;Edad&quot;;
</code></pre>
<p>Usamos la propiedad <code>Value</code> de nuestras celdas es como podemos asignarles un valor, la propiedad es de tipo <code>object</code> por lo que podemos poner ahí lo que sea.</p>
<p>Pero, como queremos distinguir los encabezados del resto de los datos, ¿por qué no los ponemos en <strong>negritas</strong>?</p>
<pre><code class="language-csharp">teacherWorksheet.Cells[&quot;A1:E1&quot;].Style.Font.Bold = true; 
</code></pre>
<p>Como puedes ver, <code>Cells</code> también nos ayuda a recuperar todo un rango de celdas, para así poder trabajar con todas ellas de una sola vez.</p>
<p>Ya por último en un ciclo <code>foreach</code> insertamos cada uno de los valores en su correspondiente celda</p>
<pre><code class="language-csharp">int cell = 2;
foreach (var teacher in Database.Teachers)
{
    teacherWorksheet.Cells[&quot;A&quot; + cell].Value = teacher.Id;
    teacherWorksheet.Cells[&quot;B&quot; + cell].Value = teacher.GivenName;
    // ... más asignaciones
    cell++;
} 
</code></pre>
<p>Tras lo cual obtendremos algo como esto:</p>
<p>&lt;img src=&quot;https://thatcsharpguy.github.io/postimages/xlsx-c-sharp/sample-1.png&quot; title=<>Documento vacío</> /&gt;</p>
<p>Podemos agregar más hojas a nuestro libro, también añadiremos una hoja para guardar las Clases impartidas por los maestros.</p>
<h2 id="hoja-de-resumen">Hoja de resumen</h2>
<p>Ahora veremos cómo agregar una página de resumen, en la cual mostraremos algunos datos basados en la información contenida dentro del libro.</p>
<h3 id="combinando-y-centrando-celdas">Combinando y centrando celdas</h3>
<p>Primero añadimos una nueva hoja al libro, después vamos a unir las celdas <code>A1</code> y <code>B1</code>, ponerlas en negritas y centrar el texto para el &quot;título&quot; de la hoja de resumen. Todo eso es posible con el siguiente código:</p>
<pre><code class="language-csharp">var summaryWorksheet = wb.Worksheets.Add(&quot;Resumen&quot;);

var titleCell = summaryWorksheet.Cells[&quot;A1:B1&quot;]; // Tomamos un rango de celdas
titleCell.Merge = true;
titleCell.Style.Font.Bold = true;
titleCell.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
titleCell.Value = &quot;Resumen&quot;;
</code></pre>
<p>Que nos dejará con el siguiente resultado:</p>
<p>&lt;img src=&quot;https://thatcsharpguy.github.io/postimages/xlsx-c-sharp/sample-2.png&quot; title=<>Documento vacío</> /&gt;</p>
<h3 id="formulas">Formulas</h3>
<p>Para añadir fórmulas debemos usar la propiedad <code>Formula</code> de las celdas, lo que si es importante es hacer referencia a ellas a través de su nombre original en inglés.</p>
<pre><code class="language-csharp">summaryWorksheet.Cells[&quot;B2&quot;].Formula = &quot;AVERAGE(Maestros!E2:E31)&quot;;  
// ...
summaryWorksheet.Cells[&quot;B3&quot;].Formula = &quot;COUNTIF(Maestros!D2:D31,\&quot;\&quot;)&quot;;
</code></pre>
<p>En este caso estamos usando AVERAGE para sacar el promedio de edad y COUNTIF para contar la cantidad de maestros sin correo electrónico.</p>
<p>&lt;img src=&quot;https://thatcsharpguy.github.io/postimages/xlsx-c-sharp/sample-3.png&quot; title=<>Documento vacío</> /&gt;</p>
<h2 id="usando-linq">Usando LINQ</h2>
<p>Una cosa que relamente es genial de EPPlus es que nos permite usar LINQ para trabajar con las hojas y celdas de nuestros libros, por ejemplo, para obtener una referencia a una hoja de trabajo existente podemos buscarla por su nombre usando el método <code>Single</code>:</p>
<pre><code class="language-csharp">var teacherWorksheet = wb.Worksheets.Single(ws =&gt; ws.Name == &quot;Maestros&quot;); 
</code></pre>
<p>Y ahora, con la referencia <code>teacherWorksheet</code> consultamos sus celdas, nuevamente usando LINQ:</p>
<pre><code class="language-csharp">var cellsWithYoungTeachers = from cell in teacherWorksheet.Cells[&quot;E:E&quot;].Skip(1)
                             where ((int)cell.Value) &lt; 20
                             select cell;
</code></pre>
<p>En el código anterior estamos:</p>
<ul>
<li>Seleccionando todas las celdas de la columna E con <code>.Cells[&quot;E:E&quot;]</code></li>
<li>Brincándonos la primera de esas celdas (porque es el título) con <code>.Skip(1)</code></li>
<li>Filtrándo las celdas que contienen un valor menor a 20 <code>where ((int)cell.Value) &lt; 20</code></li>
</ul>
<h2 id="modificando-el-formato-de-las-celdas">Modificando el formato de las celdas</h2>
<p>Después podemos iterar sobre la colección recién creada y darle un estilo diferente a las celdas que coincidieron con las condiciones que especificamos:</p>
<pre><code class="language-csharp">foreach (var cell in cellsWithYoungTeachers)
{
    cell.Style.Fill.PatternType = ExcelFillStyle.Solid;
    cell.Style.Fill.BackgroundColor.SetColor(Color.BlueViolet);
    cell.Style.Font.Color.SetColor(Color.Snow);
}
</code></pre>
<p>Que nos dejará el resultado siguiente:</p>
<img src="https://thatcsharpguy.github.io/postimages/xlsx-c-sharp/sample-4.png" title="Celdas coloreadas" />
<p>Además de poder modificar el relleno de una celda también tenemos acceso a personalizar el borde, fuente y alineación.</p>
<h2 id="formato-condicional">Formato condicional</h2>
<p>Adicionalmente a añadir nuestro propio formato, esta librería también permite trabajar con formato condicional para las celdas, y la manera de hacerlo es la siguiente:</p>
<p>Primero que nada, y como siempre, obtenemos una referencia a la hoja sobre la que vamos a trabajar y después determinamos sobre qué rango de columnas vamos a trabajar y creamos un objeto <code>ExcelAddress</code>. Para nuestro caso es sobre la columna de edad de los maestros que es la E:</p>
<pre><code class="language-csharp">var teacherWorksheet = wb.Worksheets.Single(ws =&gt; ws.Name == &quot;Maestros&quot;);
var ageCellsStringAddress = &quot;$E$2:$E$31&quot;;
var ageCellsAddress = new ExcelAddress(ageCellsStringAddress);
</code></pre>
<p>Una vez que tenemos determinado el rango, accedemos a la propiedad <code>ConditionalFormatting</code> para agregar un nuevo formato condicional, en este caso usaremos una escala de dos colores:</p>
<pre><code class="language-csharp">var formatting = teacherWorksheet.ConditionalFormatting.AddTwoColorScale(ageCellsAddress);
</code></pre>
<p>Lo siguiente es configurar el formato condicional, usaremos fórmulas para obtener el valor mínimo y máximo de las edades de los profesores:</p>
<pre><code class="language-csharp">formatting.LowValue.Type = eExcelConditionalFormattingValueObjectType.Formula;
formatting.LowValue.Formula = &quot;MIN(&quot; + ageCellsAddress + &quot;)&quot;;
formatting.LowValue.Color = Color.LightGreen;

formatting.HighValue.Type = eExcelConditionalFormattingValueObjectType.Formula;
formatting.HighValue.Formula = &quot;MAX(&quot; + ageCellsAddress + &quot;)&quot;;
formatting.HighValue.Color = Color.Green;
</code></pre>
<p>Tras lo cual el libro se verá así:</p>
<img src="https://thatcsharpguy.github.io/postimages/xlsx-c-sharp/sample-5.png" title="Formato condicional" />
<h2 id="leyendo-celdas">Leyendo celdas</h2>
<p>Así como podemos crear hojas desde cero, también podemos leer las ya existentes. Esto es particularmente útil cuando vas a solicitar información a los usuarios a través de un libro de Excel.</p>
<p>Así que supongamos que cargaremos maestros a la base con un archivo llamado <code>teachers.xlsx</code>, bastaría con abrirlo:</p>
<pre><code class="language-csharp">FileInfo uploaded = new FileInfo(&quot;teachers.xlsx&quot;);
using (ExcelPackage excel = new ExcelPackage(uploaded))
{
    // ...
</code></pre>
<p>Buscar la la hoja que necesitamos y contar las filas que contiene:</p>
<pre><code class="language-csharp">    var teacherWorksheet = excel.Workbook.Worksheets.Single(ws =&gt; ws.Name == &quot;Maestros&quot;);
    var cells = teacherWorksheet.Cells;
    int rowCount = cells[&quot;A:A&quot;].Count();
</code></pre>
<p>Y leer los datos accediendo a las celdas y su propiedad <code>Value</code>:</p>
<pre><code class="language-csharp">    for (int i = 1; i &lt;= rowCount; i++)
    {
        Console.WriteLine(
            cells[&quot;A&quot; + i].Value.ToString() + &quot;\t&quot; +
            cells[&quot;B&quot; + i].Value.ToString() + &quot;\t&quot; +
            cells[&quot;C&quot; + i].Value.ToString() + &quot;\t&quot; +
            cells[&quot;D&quot; + i].Value.ToString() + &quot;\t&quot; 
            );
    }
</code></pre>
<p>En este caso los datos leídos se imprimen a consola, pero sería sencillo insertarlos en una base de datos o hacer algun tipo de procesamiento con ellos.</p>
<h2 id="conclusion">Conclusión</h2>
<p>Sin lugar a dudas, la API de EPPlus es bastante buena y fácil de usar y si bien tiene poca documentación, es posible encontrar recursos en línea que explícan un poco más acerca de su uso. Como ya vimos, nos puede resultar útil para generar documentos desde cero o interactuar con documentos ya existentes. Es importante remarcar que para su funcionamiento <strong>no requiere que el lugar en donde se ejecute cuente con Office instalado</strong>, al igual que DocX.</p>
<h1 id="instalacion">Instalación</h1>
<p>No olvides visitar <a href="http://epplus.codeplex.com" target="_blank">la página de EPPlus en Codeplex</a> o instala el paquete de NuGet en tu proyecto:</p>
<pre><code>PM&gt; Install-Package EPPlus
</code></pre>


    </div>
</article>

                    </section>
                    <section class="sidebar">
                        <div class="theme-toggle">
  <input type="checkbox" id="theme-switch"/>
  <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
          <p class="light">Light</p>
          <p class="dark">Dark</p>
      </div>
  </label>
</div>
  


<script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>
                        <div class="post-menu">
                            <div class="post-menu-title">Sígueme en</div>
                            <div class="common-list">
                                <ul>
                                    
                                    <li>
                                        <a href="https://github.com/fferegrino">GitHub<span><i class="fab fa-github"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://twitter.com/io_exception">Twitter<span><i class="fab fa-twitter"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://youtube.com/thatcsharpguy">YouTube<span><i class="fab fa-youtube"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://tcsg.dev/discord">Discord<span><i class="fab fa-discord"></i></span></a>
                                    </li>
                                    
                                </ul>
                            </div>
                        </div>
                        
 <style type="text/css" media="screen">
    .post-menu ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
</style>
<div class="post-menu toc">
    <div class="post-menu-title">TOC</div>
    <div class="post-menu-content"></div>
</div>
<script>
    function generateContent() {
        var menu = document.querySelector(".post-menu.toc");
        console.log(menu);
        var menuContent = menu.querySelector(".post-menu-content");
        var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");
        // Hide menu when no headings
        if (headings.length === 0) {
            return menu.style.display = "none";
        }
        // Generate post menu
        var menuHTML = '';
        for (var i = 0; i < headings.length; i++) {
            var h = headings[i];
            menuHTML += ('<li class="h-' + h.tagName.toLowerCase() + '">' + '<a href="#' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
        }
        menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';
        // The header element
        var header = document.querySelector('header.site-header');
        function doMenuCollapse(index, over_items) {
            var items = menuContent.firstChild.children;
            if (over_items == undefined) {
                over_items = 20;
            }
            if (items.length<over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0 && ! items[beginIndex].classList.contains('h-h2')) {
                beginIndex -= 1;
            }
            while (endIndex < items.length && ! items[endIndex].classList.contains('h-h2')) {
                endIndex += 1;
            }
            for (var i = 0; i < beginIndex; i++) {
                item = items[i]
                if (!item.classList.contains('h-h2')) {
                    item.style.display = 'none';
                }
            }
            for (var i = beginIndex + 1; i < endIndex; i++) {
                item = items[i]
                // if (!item.classList.contains('h-h2')) {
                item.style.display = '';
                // }
            }
            for (var i = endIndex; i < items.length; i++) {
                item = items[i]
                if (!item.classList.contains('h-h2')) {
                    item.style.display = 'none';
                }
            }
        }
        // Init menu collapsed
        doMenuCollapse(-1);
        // Active the menu item
        window.addEventListener('scroll', function (event) {
            var lastActive = menuContent.querySelector('.active');
            var changed = true;
            var activeIndex = -1;
            for (var i = headings.length - 1; i >= 0; i--) {
                var h = headings[i];
                var headingRect = h.getBoundingClientRect();
                var headerRect = header.getBoundingClientRect();
                var headerTop = Math.floor(headerRect.top);
                var headerHeight = Math.floor(headerRect.height);
                var headerHeight = headerTop + headerHeight + 20;
                if (headingRect.top <= headerHeight) {
                    var id = 'h-' + h.getAttribute('id');
                    var a = menuContent.querySelector('a[href="#' + id + '"]');
                    var curActive = a.parentNode;
                    if (curActive) {
                        curActive.classList.add('active');
                        activeIndex = i;
                    }
                    if (lastActive == curActive) {
                        changed = false;
                    }
                    break;
                }
            }
            if (changed) {
                if (lastActive) {
                    lastActive.classList.remove('active');
                }
                doMenuCollapse(activeIndex);
            }
            event.preventDefault();
        });
    }
    document.addEventListener("DOMContentLoaded", function() {
        generateContent()
    });
</script>

                    </section>
                </div>
            </div>
        </div>
        <footer class="site-footer h-card">
   <data class="u-url" href="/"></data>
 
   <div class="wrapper">
     <div class="site-footer-inner">
       <div> </div>
       <div>Powered by <a title="Lockdonw in a simple, blog-aware, static site generator." href="https://github.com/lockdownblog/lockdown">Lockdown</a> &amp; <a title="Yat, yetanother theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
       <!-- <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></div> -->
     </div>
   </div>
 </footer>
    </body>
</html>